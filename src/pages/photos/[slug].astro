---
import { IconChevronLeft, IconLoader2 } from "@tabler/icons-react";
import { Image } from "astro:assets";
import { ExifDetails } from "~/components/exif-details";
import { LinkButton } from "~/components/link-button";
import Root from "~/layouts/root.astro";
import { getFilePath } from "~/lib/exif";
import { getPhotos } from "~/lib/photos";
import { type AsyncReturnType } from "~/lib/utils";

export async function getStaticPaths() {
  const photos = await getPhotos();

  return photos.map((photo, i) => ({
    params: { slug: i },
    props: { photo, i },
  }));
}

const { photo, i } = Astro.props as {
  photo: AsyncReturnType<typeof getPhotos>[number];
  i: number;
};

photo.data.exif.MakerNote = undefined;
---

<Root
  title={"Photos Â· Zachary Robinson"}
  parent="Photos"
  ogImage={`/og/photos/${i}.png`}
  noIndex
>
  <article class="mx-auto flex max-w-prose flex-col gap-4">
    <a href="/photos" class="group text-muted-foreground">
      <IconChevronLeft
        className="mb-0.5 inline transition-transform group-hover:-translate-x-1"
        size={16}
      />
       Back to All Photos
    </a>

    <div class="relative">
      <Image
        src={photo.file}
        alt={"image preview for image #" + i}
        class="rounded-lg object-contain"
        quality="max"
        loading="eager"
      />

      <div
        style={`aspect-ratio: ${photo.aspectRatio};`}
        class="absolute top-0 -z-10 flex w-full items-center justify-center rounded-lg bg-zinc-800"
      >
        <IconLoader2 size={48} className="animate-spin text-zinc-100" />
      </div>
    </div>

    <div class="flex w-1/2 flex-col gap-4 rounded-lg border border-border p-4">
      <ExifDetails details={photo.data} className="gap-2" />

      <div class="flex gap-4">
        <LinkButton href="/photos" size="sm" className="basis-1/2">
          All Photos
        </LinkButton>

        <LinkButton
          href={`https://raw.githubusercontent.com/zsrobinson/portfolio/gallery-section/${getFilePath(
            photo.file.src,
          )}`}
          size="sm"
          variant="secondary"
          className="basis-1/2"
        >
          View Original
        </LinkButton>
      </div>
    </div>

    <div class="whitespace-pre">
      {JSON.stringify(photo.data, null, 2)}
    </div>
  </article>
</Root>
